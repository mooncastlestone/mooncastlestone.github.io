{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-tsx","path":"/react/post-2/","result":{"data":{"markdownRemark":{"html":"<p>React hooks에서 대표적으로 많이 사용하는 상태 관리를 위한 useState.\n리액트로 개발을 진행하면서 많이 사용하고 있는데, 내부적으로 어떤 식으로 상태와 상태를 변경하는 함수를 받아오고 있는지 궁금해서 확인해보고자 한다.</p>\n<h2 id=\"usestate의-내부-구조\" style=\"position:relative;\"><a href=\"#usestate%EC%9D%98-%EB%82%B4%EB%B6%80-%EA%B5%AC%EC%A1%B0\" aria-label=\"usestate의 내부 구조 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useState의 내부 구조</h2>\n<p>React hooks 중 상태를 관리할 수 있는 useState를 사용하면 구조 분해 할당을 사용하여 아래와 같이 상태 값과 상태를 변경할 수 있는 함수를 받아올 수 있다.</p>\n<pre class=\"grvsc-container one-dark-pro\" data-language=\"javascript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">const</span><span class=\"mtk1\"> [ </span><span class=\"mtk11\">state</span><span class=\"mtk1\">, </span><span class=\"mtk11\">setState</span><span class=\"mtk1\"> ] </span><span class=\"mtk8\">=</span><span class=\"mtk1\"> </span><span class=\"mtk3\">useState</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;test&#39;</span><span class=\"mtk1\">)           </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span></code></pre>\n<p>이 state와 setState는 어떤 식으로 useState를 통해서 받아와지게 되는 걸까? useState가 선언되어있는 react 모듈을 탐색해보자!</p>\n<p><img src=\"https://images.velog.io/images/moon3356/post/c89a9eed-9c2f-420f-8c7a-38fe115a4c2f/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-09-02%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%209.35.05.png\" alt=\"\"></p>\n<p>node_modules > react > cjs > react.development.js에서 위와 같이 useState가 선언되어져 있는 것을 확인할 수 있다. 개발자가 useState를 실행하면 변수 dispatcher를 선언하고 resolveDispatcher 외부 함수를 실행하여 값을 할당받는다. 그리고 변수에 할당된 내부 useState 메소드를 실행한다. 여기서 return 되는 것들이 상태와 상태를 관리하는 함수인 것인데, resolveDispatcher 함수는 어떤 값을 dispatcher 변수에 할당한 것일까? resolveDispatcher를 탐색해보자.</p>\n<p><img src=\"https://images.velog.io/images/moon3356/post/1f2ed632-b77c-4d76-a931-b23ee4d753ee/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-09-02%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%209.38.17.png\" alt=\"\"></p>\n<p>resolveDispatcher 함수를 실행하면 다시 변수 dispatcher를 선언하고 외부에 선언된 ReactCurrentDispatcher 객체의 current를 할당 받는다. 그리고 에러 처리를 진행하고 선언한 변수 dispatcher를 리턴한다. 그렇다면 이번엔 ReactCurrentDispatcher.current는 어떤 값을 dispatcher 변수에 할당한 것일까? 이번에야말로 우리가 원하는 state와 setState를 반환받는 것일까? 다시 한번 탐색해보자..</p>\n<p><img src=\"https://images.velog.io/images/moon3356/post/6fb990b6-0399-4ba2-bcf1-93bde0264ce2/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-09-02%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%209.42.17.png\" alt=\"\"></p>\n<p>음..... 없다. 그냥 전역으로 선언된 객체 하나만 있다. 이 객체의 current는 null만을 가지고 있다. 그렇다면 내가 찾고 있는 state와 useState는 또 다른 외부 함수, 변수로부터 받아오는 것일까?</p>\n<p>또다시 ReactCurrentDispatcher가 사용되는 곳을 찾기 위해 탐색을 하다가 아래와 같은 객체를 발견할 수 있었다.</p>\n<p><img src=\"https://images.velog.io/images/moon3356/post/885be1d3-1097-4175-b137-5834f968adb2/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-09-02%20%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB%209.49.58.png\" alt=\"\"></p>\n<p>이 ReactSharedInternals 객체에 ReactCurrentDispatcher가 할당이 되어서 활용이 되는 듯 하다. 여기서 더 탐색하다가는 React 관련 코드들을 모조리 뜯어보게 될 것 같아 잠시 멈췄다..</p>\n<p>일단은 ReactCurrentDispatcher.current에 내가 선언한 state와 useState가 일련의 과정을 거친 후에 할당된다고 생각하면 될 것 같다.</p>\n<h2 id=\"중간-정리\" style=\"position:relative;\"><a href=\"#%EC%A4%91%EA%B0%84-%EC%A0%95%EB%A6%AC\" aria-label=\"중간 정리 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>중간 정리</h2>\n<p>useState를 사용할 때마다 내부 변수 dispatcher를 생성하고 전역으로 선언된 객체로부터 state와 setState를 반환받는다.</p>\n<h2 id=\"usestate와-closure의-관계성\" style=\"position:relative;\"><a href=\"#usestate%EC%99%80-closure%EC%9D%98-%EA%B4%80%EA%B3%84%EC%84%B1\" aria-label=\"usestate와 closure의 관계성 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useState와 Closure의 관계성</h2>\n<p>위에서 살펴보았듯이 useState를 실행하면 dispatcher 내부 변수를 선언하고 외부에 선언된 변수 ReactCurrentDispatcher로부터 state와 setState를 가져온다. 즉, 내부 함수의 변수가 외부 함수의 변수에 접근한다는 것인데, 여기서 우리는  useState가 <strong>Closure</strong> 매커니즘으로 동작이 되는 것을 확인할 수 있다.</p>\n<h2 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"custom-class before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며</h2>\n<p>평소 그저 사용하기만 하던 하나의 react hook에 정말 많은 코드들이 상호 작용하면서 동작하고 있는 것을 보니, 더 많은 공부를 해야겠다는 생각이 든다...! 더 열심히 하자!!</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .one-dark-pro {\n    background-color: #282c34;\n    color: #abb2bf;\n  }\n  .one-dark-pro .mtk10 { color: #C678DD; }\n  .one-dark-pro .mtk1 { color: #ABB2BF; }\n  .one-dark-pro .mtk11 { color: #E5C07B; }\n  .one-dark-pro .mtk8 { color: #56B6C2; }\n  .one-dark-pro .mtk3 { color: #61AFEF; }\n  .one-dark-pro .mtk6 { color: #98C379; }\n  .one-dark-pro .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","tableOfContents":"<ul>\n<li><a href=\"#usestate%EC%9D%98-%EB%82%B4%EB%B6%80-%EA%B5%AC%EC%A1%B0\">useState의 내부 구조</a></li>\n<li><a href=\"#%EC%A4%91%EA%B0%84-%EC%A0%95%EB%A6%AC\">중간 정리</a></li>\n<li><a href=\"#usestate%EC%99%80-closure%EC%9D%98-%EA%B4%80%EA%B3%84%EC%84%B1\">useState와 Closure의 관계성</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며</a></li>\n</ul>","frontmatter":{"date":"September 15, 2021","slug":"/react/post-2/","title":"useState 내부 구조 탐색"}}},"pageContext":{"id":"5c5780c6-c431-5ba8-b2cc-c1cc5cdea520","frontmatter__slug":"/react/post-2/","__params":{"frontmatter__slug":"react"}}},"staticQueryHashes":["2842829498"]}